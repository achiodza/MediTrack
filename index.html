<!doctype html>
<html lang="en" class="light-style layout-wide customizer-hide" dir="ltr" data-theme="theme-default" data-assets-path="assets/" data-template="vertical-menu-template-free" data-style="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>MediTrack | Login</title>
  <meta name="description" content="" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/img/favicon/favicon.ico" />
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="assets/vendor/fonts/boxicons.css" />
  <link rel="stylesheet" href="assets/vendor/css/core.css" />
  <link rel="stylesheet" href="assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="assets/css/demo.css" />
  
  <!-- Vendors CSS -->
  <link rel="stylesheet" href="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <link rel="stylesheet" href="assets/vendor/css/pages/page-auth.css" />
  
  <!-- Helpers -->
  <script src="assets/vendor/js/helpers.js"></script>
  <script src="assets/js/config.js"></script>
</head>

<body>
  <!-- Content -->
  <div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
      <div class="authentication-inner">
        <!-- Register -->
        <div class="card px-sm-6 px-0">
          <div class="card-body">
            <!-- Logo -->
            <div class="app-brand justify-content-center">
              <a href="home.html" class="app-brand-link gap-2">
                <span class="app-brand-text demo text-heading fw-bold">MediTrack</span>
              </a>
            </div>
            <!-- /Logo -->
            <h4 class="mb-1">Welcome to MediTrack! ðŸ‘‹</h4>
            <p class="mb-6">Please sign-in to your account</p>
            
            <!-- Login Form -->
            <form id="loginForm" class="mb-6">
              <div class="mb-6">
                <label for="email" class="form-label">Email or Username</label>
                <input type="text" class="form-control" id="email" name="email" placeholder="Enter your email or username" autofocus required />
              </div>
              <div class="mb-6 form-password-toggle">
                <label class="form-label" for="password">Password</label>
                <div class="input-group input-group-merge">
                  <input type="password" id="password" class="form-control" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
                  <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                </div>
              </div>
              <div class="mb-6">
                <label for="userType" class="form-label">User Type</label>
                  <select class="form-control" id="userType" name="userType" required>
                    <option value="">Select User Type</option>
                    <option value="clinician">Clinician</option>
                    <option value="laboratory_scientist">Laboratory Scientist</option>
                    <option value="pharmacy">Pharmacy</option>
                  </select>
              </div>
              </div>
              <div class="mb-6">
                <button class="btn btn-primary d-grid w-100" type="submit">Login</button>
              </div>
              <p id="error-message" class="text-danger text-center"></p> <!-- Error message -->
              <div id="loader" style="display:none;" class="text-center">Loading...</div> <!-- Loader -->
            </form>
            
            <!-- Forgot Password Link -->
            <p class="text-center mb-4">
              <a href="./pages/forgotpassword.html">Forgot Password</a>
            </p>
            
            <p class="text-center">
              <span>New on our platform?</span>
              <a href="./pages/auth-register.html">Create an account</a>
            </p>
            
            <!-- Core JS -->
            <script src="assets/vendor/libs/jquery/jquery.js"></script>
            <script src="assets/vendor/libs/popper/popper.js"></script>
            <script src="assets/vendor/js/bootstrap.js"></script>
            <script src="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
            <script src="assets/vendor/js/menu.js"></script>
            
            <!-- Main JS -->
            <script src="assets/js/main.js"></script>
            
            <!-- JavaScript for login logic -->
            <script>
              document.getElementById('loginForm').addEventListener('submit', function(event) {
                event.preventDefault();
            
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const errorMessage = document.getElementById('error-message');
                const loader = document.getElementById('loader');
            
                loader.style.display = 'block'; // Show loader
            
                // API request to login
                fetch('http://198.177.123.228:1337/api/auth/local', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    identifier: email, // Can be email or username
                    password: password
                  })
                })
                .then(response => response.json())
                .then(data => {
                  loader.style.display = 'none'; // Hide loader
            
                  if (data.jwt) {
                    // Successful login
                    localStorage.setItem('authToken', data.jwt); // Store JWT token in localStorage
            
                    // Redirect to dashboard or home page
                    window.location.href = './pages/home.html'; 
                  } else {
                    // Show error message
                    errorMessage.textContent = 'Login failed: ' + (data.message[0].messages[0].message || 'Invalid credentials');
                  }
                })
                .catch(error => {
                  console.error('Error:', error);
                  errorMessage.textContent = 'An error occurred during login: ' + error.message;
                  loader.style.display = 'none'; // Hide loader
                });
              });
            </script>
            
</body>
</html>
